<div class="card p-3">
  <h2>Nuevo ingreso</h2>

  <div class="row g-2 mb-2">
    <div class="col-md-3">
      <label class="form-label">Proveedor (opcional)</label>
      <input type="number" class="form-control" [formControl]="form.controls.supplierId" placeholder="ID proveedor">
    </div>
    <div class="col-md-9">
      <label class="form-label">Nota</label>
      <input type="text" class="form-control" [formControl]="form.controls.note" placeholder="Observaci√≥n">
    </div>
  </div>

  <hr>

  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th style="width:42%">Producto</th>
          <th style="width:12%">Costo</th>
          <th style="width:12%">Cantidad</th>
          <th style="width:12%">Subtotal</th>
          <th style="width:8%"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let it of items.controls; index as i">
          <td class="position-relative">
            <input type="text" class="form-control" [value]="it.value.productName" (input)="search(i, $any($event.target).value)" placeholder="Buscar...">
            <ul class="list-group position-absolute w-100" *ngIf="foundProducts.length" style="z-index: 1000; max-height: 220px; overflow:auto;">
              <li class="list-group-item list-group-item-action" *ngFor="let p of foundProducts" (click)="pickProduct(i, p)">{{p.name}}</li>
            </ul>
          </td>
          <td><input type="number" min="0" step="0.01" class="form-control" [formControl]="$any(it.get('unitCost'))"></td>
          <td><input type="number" min="1" step="1" class="form-control" [formControl]="$any(it.get('quantity'))"></td>
          <td>{{ (it.value.quantity||0) * (it.value.unitCost||0) | number:'1.2-2' }}</td>
          <td><button type="button" class="btn btn-outline-danger btn-sm" (click)="removeItem(i)">üóëÔ∏è</button></td>
        </tr>
      </tbody>
    </table>
    <button type="button" class="btn btn-outline-primary" (click)="addItem()">+ Agregar √≠tem</button>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <div *ngIf="error" class="text-danger">{{ error }}</div>
    <div><strong>Total:</strong> {{ total | number:'1.2-2' }}</div>
  </div>

  <div class="mt-3">
    <button class="btn btn-primary" [disabled]="loading" (click)="submit()">
      {{ loading ? 'Guardando...' : 'Registrar ingreso' }}
    </button>
  </div>
</div>

