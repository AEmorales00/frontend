<h2>ðŸ§¾ Nueva venta</h2>

<div class="actions">
  <button class="btn" (click)="startScan()" [disabled]="scanning">ðŸ“· Escanear</button>
  <button class="btn btn-secondary" (click)="stopScan()" [disabled]="!scanning">â–  Detener</button>

  <div class="manual">
    <input type="text" placeholder="CÃ³digo de barras" [(ngModel)]="barcodeManual">
    <input type="number" min="1" [(ngModel)]="cantidad" style="width:100px">
    <button class="btn" (click)="buscarManual()">âž• Agregar</button>
  </div>
</div>

<div class="preview" *ngIf="scanning">
  <video id="video-preview" playsinline style="width:100%;max-width:520px;border-radius:10px"></video>
</div>

<div class="cart" *ngIf="cart.length">
  <table class="table">
    <thead>
      <tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Subtotal</th><th></th></tr>
    </thead>
    <tbody>
      <tr *ngFor="let it of cart; let i = index">
        <td>{{ it.product.name }}</td>
        <td>{{ it.product.price | number:'1.2-2' }}</td>
        <td><input type="number" min="1" [ngModel]="it.quantity" (ngModelChange)="changeQty(i, $event)" style="width:90px"></td>
        <td>{{ it.subtotal | number:'1.2-2' }}</td>
        <td><button class="btn btn-danger" (click)="remove(i)">âœ–</button></td>
      </tr>
    </tbody>
  </table>

  <div class="total">
    <div>Total: <strong>{{ total | number:'1.2-2' }}</strong></div>
    <button class="btn btn-primary" (click)="confirmarVenta()">Confirmar venta</button>
  </div>
</div>

<div *ngIf="!cart.length" class="hint">Escanea un producto o usa el cÃ³digo manual para empezar.</div>